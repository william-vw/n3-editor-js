# Processed by EYE v4.6.0 (2023-07-14)
# eye /Users/wvw/git/n3/n3-editor-js/out/query.spin /Users/wvw/git/n3/n3-editor-js/lib/spin3/auxiliary-files/aux.n3 --query /Users/wvw/git/n3/n3-editor-js/lib/spin3/queries/query_general.n3 --nope --quantify http://eyereasoner.github.io/.well-known/genid/

@prefix string: <http://www.w3.org/2000/10/swap/string#>.
@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix spin: <http://spinrdf.org/spin#>.
@prefix sp: <http://spinrdf.org/sp#>.
@prefix ex: <http://example.org/spin#>.
@prefix aux: <http://example.org/aux#>.
@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix time: <http://www.w3.org/2000/10/swap/time#>.
@prefix crypto: <http://www.w3.org/2000/10/swap/crypto#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix e: <http://eulersharp.sourceforge.net/2003/03swap/log-rules#>.
@prefix var: <http://eyereasoner.github.io/.well-known/genid/caffdbed-7526-434e-85ab-1067018a2754#>.

{
    ?t_47 a <http://hl7.org/fhir/Patient>.
    ?t_47 <http://example.org/utils#hasCondition> ?t_48.
    (?t_48 77386006) aux:stepThroughPath ((<http://hl7.org/fhir/code> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_48 "active") aux:stepThroughPath ((<http://hl7.org/fhir/clinicalStatus> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_48 "confirmed") aux:stepThroughPath ((<http://hl7.org/fhir/verificationStatus> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
} => {
    ?t_47 <http://example.org/zika#isPregnant> true.
}.
{
    ?t_47 a <http://hl7.org/fhir/Patient>.
    ?t_47 <http://example.org/utils#hasCondition> ?t_48.
    (?t_48 "active") aux:stepThroughPath ((<http://hl7.org/fhir/clinicalStatus> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_48 "confirmed") aux:stepThroughPath ((<http://hl7.org/fhir/verificationStatus> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_48 ?t_49) aux:stepThroughPath ((<http://hl7.org/fhir/code> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    ?t_49 list:in (84387000 271749004 47725002 57676002 9826008 68962001 25064002).
} => {
    ?t_47 <http://example.org/zika#hasZikaSymptom> ?t_48.
}.
{
    ?t_47 a <http://hl7.org/fhir/Patient>.
    <http://example.org/zika#world> <http://example.org/zika#hasZikaArea> ?t_50.
    (?t_47 ?t_50) aux:stepThroughPath ((<http://hl7.org/fhir/address> 1 1) (<http://hl7.org/fhir/country> 1 1) (<http://hl7.org/fhir/v> 1 1)).
} => {
    ?t_47 <http://example.org/zika#residentOfZikaArea> true.
}.
{
    ?t_47 a <http://hl7.org/fhir/Patient>.
    ?t_47 <http://example.org/utils#hasObservation> ?t_51.
    <http://example.org/zika#world> <http://example.org/zika#hasZikaArea> ?t_50.
    ?t_52 <http://example.org/utils#timeSinceObsEnd> ?t_53.
    (?t_51 420008001) aux:stepThroughPath ((<http://hl7.org/fhir/code> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_51 ?t_52) aux:stepThroughPath ((<http://hl7.org/fhir/component> 1 1) (((rdf:rest 1 1)) 0 -2) (rdf:first 1 1)).
    (?t_52 "LOC") aux:stepThroughPath ((<http://hl7.org/fhir/code> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_52 ?t_50) aux:stepThroughPath ((<http://hl7.org/fhir/extension> 1 1) (((rdf:rest 1 1)) 0 -2) (rdf:first 1 1) (<http://hl7.org/fhir/value> 1 1) (<http://hl7.org/fhir/country> 1 1) (<http://hl7.org/fhir/v> 1 1)).
    ?t_53 math:lessThan 2678400000.
} => {
    ?t_47 <http://example.org/zika#recentTravelToZikaArea> true.
}.
{
    (?t_54 ?t_50) aux:stepThroughPath ((<http://hl7.org/fhir/country> 1 1) (<http://hl7.org/fhir/v> 1 1)).
    ?t_50 list:in ("American Samoa" "Angola" "Anguilla" "Antigua and Barbuda" "Argentina" "Aruba" "Bahamas" "Bangladesh" "Barbados" "Belize" "Bolivia" "Bonaire" "Brazil" "British Virgin Islands" "Burkina Faso" "Burma" "Burundi" "Cambodia" "Cameroon" "Cape Verde" "Cayman Islands" "Central African Republic" "Colombia" "Cook Islands" "Costa Rica" "Cuba" "Curacao" "Dominica" "Dominican Republic" "Easter Island" "Ecuador" "El Salvador" "Ethiopia" "Federated States of Micronesia" "Fiji" "France" "French Guiana" "French Polynesia" "Gabon" "Grenada" "Guadeloupe" "Guatemala" "Guinea-Bissau" "Guyana" "Haiti" "Honduras" "India" "Indonesia" "Ivory Coast" "Jamaica" "Kenya" "Kiribati" "Laos" "Malaysia" "Maldives" "Marshall Islands" "Martinique" "Mexico" "Montserrat" "New Caledonia" "Nicaragua" "Nigeria" "Palau" "Panama" "Papua New Guinea" "Paraguay" "Peru" "Philippines" "Puerto Rico" "Saba" "Saint Barthelemy" "Saint Kitts and Nevis" "Saint Lucia" "Saint Martin" "Saint Vincent and the Grenadines" "Samoa" "Senegal" "Singapore" "Sint Eustatius" "Sint Maarten" "Solomon Islands" "Suriname" "Thailand" "Tonga" "Trinidad and Tobago" "Turks and Caicos" "Uganda" "United States (Continental US)" "United States Virgin Islands" "Vanuatu" "Venezuela" "Vietnam").
} => {
    <http://example.org/zika#world> <http://example.org/zika#hasZikaArea> ?t_50.
}.
{
    ?t_47 <http://example.org/utils#hasObservation> ?t_51.
    ?t_51 <http://example.org/utils#timeSinceObsEnd> ?t_53.
    (?t_51 225517006) aux:stepThroughPath ((<http://hl7.org/fhir/code> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_51 ?t_55) aux:stepThroughPath ((<http://hl7.org/fhir/value> 1 1) (<http://example.org/utils#refersTo> 1 1)).
    ?t_53 math:lessThan 2678400000 .
    ?t_55 <http://example.org/zika#recentTravelToZikaArea> true.
} => {
    ?t_47 <http://example.org/zika#recentSexualEncounterWithZikaResidentOrTraveler> true.
}.
{
    ?t_47 <http://example.org/utils#hasObservation> ?t_51.
    ?t_51 <http://example.org/utils#timeSinceObsEnd> ?t_53.
    (?t_51 225517006) aux:stepThroughPath ((<http://hl7.org/fhir/code> 1 1) (<http://example.org/utils#hasCodeValue> 1 1)).
    (?t_51 ?t_55) aux:stepThroughPath ((<http://hl7.org/fhir/value> 1 1) (<http://example.org/utils#refersTo> 1 1)).
    ?t_53 math:lessThan 2678400000 .
    ?t_55 <http://example.org/zika#residentOfZikaArea> true.
} => {
    ?t_47 <http://example.org/zika#recentSexualEncounterWithZikaResidentOrTraveler> true.
}.
{
    ?t_47 <http://example.org/zika#recentTravelToZikaArea> true.
} => {
    ?t_47 <http://example.org/zika#possibleZikaExposure> true.
}.
{
    ?t_47 <http://example.org/zika#recentSexualEncounterWithZikaResidentOrTraveler> true.
} => {
    ?t_47 <http://example.org/zika#possibleZikaExposure> true.
}.
{
    (((("p" ?t_47)) (("c" ?t_56) ("timeSince" ?t_57))) {
        ?t_47 a <http://hl7.org/fhir/Patient>.
        ?t_47 <http://example.org/zika#hasZikaSymptom> ?t_56.
        ?t_56 <http://example.org/utils#timeSinceCondOnset> ?t_57.
    } ?t_58) log:collectAllIn ?t_59.
    (?t_60 ?t_61) list:in ?t_58.
    (?t_62 {
        (?t_60 ?t_63) list:in ?t_58.
        ("timeSince" ?t_62) list:in ?t_63.
    } ?t_64) log:collectAllIn ?t_59.
    ("p" ?t_47) list:in ?t_60.
    ?t_64 math:sum ?t_65.
    ?t_64 list:length ?t_66.
    (?t_65 ?t_66) math:quotient ?t_67.
} => {
    ?t_47 <http://example.org/zika#avgTimeSinceZikaSymptomsOnset> ?t_67.
}.
{
    ?t_47 <http://example.org/zika#isPregnant> true.
    ?t_47 <http://example.org/zika#hasZikaSymptom> ?t_68.
    ?t_47 <http://example.org/zika#possibleZikaExposure> true.
    ?t_47 <http://example.org/zika#avgTimeSinceZikaSymptomsOnset> ?t_53.
    ?t_53 math:lessThan 7257600000.
} => {
    _:e_b1_1 a <http://hl7.org/fhir/ServiceRequest>.
    _:e_b1_1 <http://hl7.org/fhir/code> _:e_b2_1.
    _:e_b2_1 <http://hl7.org/fhir/concept> _:e_b3_1.
    _:e_b3_1 <http://hl7.org/fhir/coding> _:e_b4_1.
    _:e_b4_1 rdf:first _:e_b5_1.
    _:e_b5_1 <http://hl7.org/fhir/system> _:e_b6_1.
    _:e_b6_1 <http://hl7.org/fhir/v> "http://snomed.org/sct"^^xsd:anyURI.
    _:e_b5_1 <http://hl7.org/fhir/code> _:e_b7_1.
    _:e_b7_1 <http://hl7.org/fhir/v> "69363007".
    _:e_b4_1 rdf:rest ().
    _:e_b3_1 <http://hl7.org/fhir/text> _:e_b8_1.
    _:e_b8_1 <http://hl7.org/fhir/v> "Zika virus NAAT on serum".
}.
{
    ?t_47 <http://example.org/utils#has> ?t_48.
    ?t_48 a <http://hl7.org/fhir/Condition>.
} => {
    ?t_47 <http://example.org/utils#hasCondition> ?t_48.
}.
{
    ?t_47 <http://example.org/utils#has> ?t_51.
    ?t_51 a <http://hl7.org/fhir/Observation>.
} => {
    ?t_47 <http://example.org/utils#hasObservation> ?t_51.
}.
{
    (?t_47 ?t_69) aux:stepThroughPath ((<http://hl7.org/fhir/id> 1 1) (<http://hl7.org/fhir/v> 1 1)).
    (?t_70 ?t_69) aux:stepThroughPath ((<http://hl7.org/fhir/subject> 1 1) (<http://hl7.org/fhir/reference> 1 1) (<http://hl7.org/fhir/v> 1 1)).
} => {
    ?t_47 <http://example.org/utils#has> ?t_70.
}.
{
    (?t_70 ?t_48) aux:stepThroughPath ((<http://hl7.org/fhir/coding> 1 1) (((rdf:rest 1 1)) 0 -2) (rdf:first 1 1) (<http://hl7.org/fhir/code> 1 1) (<http://hl7.org/fhir/v> 1 1)).
} => {
    ?t_70 <http://example.org/utils#hasCodeValue> ?t_48.
}.
{
    (?t_47 ?t_69) aux:stepThroughPath ((<http://hl7.org/fhir/id> 1 1) (<http://hl7.org/fhir/v> 1 1)).
    (?t_70 ?t_69) aux:stepThroughPath ((<http://hl7.org/fhir/reference> 1 1) (<http://hl7.org/fhir/v> 1 1)).
} => {
    ?t_70 <http://example.org/utils#refersTo> ?t_47.
}.
{
    ?t_51 <http://hl7.org/fhir/effective> ?t_71.
    <http://example.org/utils#now> rdf:value ?t_72.
    (?t_71 ?t_73) aux:stepThroughPath ((<http://hl7.org/fhir/start> 1 1) (<http://hl7.org/fhir/v> 1 1)).
    (?t_71 ?t_74) aux:stepThroughPath ((<http://hl7.org/fhir/end> 1 1) (<http://hl7.org/fhir/v> 1 1)).
    ?t_75 log:equalTo ?t_53.
    (?t_72 ?t_74) math:difference ?t_75.
} => {
    ?t_51 <http://example.org/utils#timeSinceObsEnd> ?t_53.
}.
{
    <http://example.org/utils#now> rdf:value ?t_72.
    (?t_48 ?t_76) aux:stepThroughPath ((<http://hl7.org/fhir/onset> 1 1) (<http://hl7.org/fhir/v> 1 1)).
    ?t_77 log:equalTo ?t_53.
    (?t_72 ?t_76) math:difference ?t_77.
} => {
    ?t_48 <http://example.org/utils#timeSinceCondOnset> ?t_53.
}.
# 2023-07-22T15:09:34.728Z in=819 out=18 ent=18 step=18 brake=2 inf=1008545 sec=0.072 inf/sec=14007569
# ENDS

